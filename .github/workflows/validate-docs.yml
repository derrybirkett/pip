name: Validate Documentation

on:
  pull_request:
    paths:
      - '**.md'
      - 'patterns/**'
      - 'docs/**'
      - 'ia/**'
  push:
    branches:
      - main
    paths:
      - '**.md'
      - 'patterns/**'
      - 'docs/**'
      - 'ia/**'

jobs:
  structure-validation:
    name: Validate Repository Structure
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify required directories exist
        run: |
          echo "Checking directory structure..."
          
          # Core directories
          test -d "patterns/agent-workflows" || (echo "❌ Missing patterns/agent-workflows" && exit 1)
          test -d "patterns/decision-frameworks" || (echo "❌ Missing patterns/decision-frameworks" && exit 1)
          test -d "patterns/quality-metrics" || (echo "❌ Missing patterns/quality-metrics" && exit 1)
          test -d "ia/agents" || (echo "❌ Missing ia/agents" && exit 1)
          test -d "docs" || (echo "❌ Missing docs" && exit 1)
          test -d "fragments" || (echo "❌ Missing fragments" && exit 1)
          
          echo "✅ All required directories present"

      - name: Verify core documentation files exist
        run: |
          echo "Checking core documentation..."
          
          # Core files
          test -f "README.md" || (echo "❌ Missing README.md" && exit 1)
          test -f "WARP.md" || (echo "❌ Missing WARP.md" && exit 1)
          test -f "ROADMAP.md" || (echo "❌ Missing ROADMAP.md" && exit 1)
          test -f "docs/activity-log.md" || (echo "❌ Missing docs/activity-log.md" && exit 1)
          test -f "docs/changelog.md" || (echo "❌ Missing docs/changelog.md" && exit 1)
          
          echo "✅ All core documentation files present"

      - name: Check pattern count
        run: |
          echo "Checking pattern files..."
          
          pattern_count=$(find patterns/agent-workflows -name '*.md' 2>/dev/null | wc -l)
          echo "Found $pattern_count pattern file(s)"
          
          if [ $pattern_count -gt 0 ]; then
            echo "✅ Patterns directory has content"
          else
            echo "ℹ️  No patterns yet (this is fine for early development)"
          fi
